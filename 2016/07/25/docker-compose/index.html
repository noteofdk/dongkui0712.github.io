<!DOCTYPE html>
<html lang="en">


<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>
    Docker compose note (ing) | DongKui&#39;s Note
  </title>
  <meta name="description" content="散卷凉盏伴携程，一蓑烟雨任平生">
  
  <meta name="keywords" content="
  compose
  ">
  
  <meta name="author" content="DongKui">

  <meta http-equiv="Cache-Control" content="no-transform"/>
  <meta http-equiv="Cache-Control" content="no-siteapp">

  <link rel="icon" type="image/x-icon" href="undefined">
  <link rel="stylesheet" href="/css/main.css">
  <link rel="stylesheet"
        href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  

  

  <script src="//cdnjs.cloudflare.com/ajax/libs/vue/1.0.25-csp/vue.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.11.2/moment.min.js"></script>
</head>

<body id="replica-app">

<nav class="navbar-wrapper">
  <div class="navbar">
    <div class="container clearfix">
      <a href="/" class="navbar-logo"><i class="fa fa-github"></i></a>

      <div class="navbar-search float-left desktop-only">
        <div class="navbar-search-form">
          <label for="gsc-i-id1">This website</label>
          <div id="google-search">
            <gcse:search></gcse:search>
          </div>
        </div>
      </div>

      <ul class="navbar-nav float-left">
        
        <li><a href="/archives">Archives</a></li>
        
        
        <li><a href="/categories">Categories</a></li>
        
        
        <li><a href="/tags">Tags</a></li>
        
        
        <li><a href="/atom.xml" target="_blank">RSS</a></li>
        
      </ul>

      <ul class="navbar-nav user-nav float-right desktop-only">
        <li class="user-nav-notification">
          <a><span class="user-nav-unread"></span><i class="fa fa-bell"></i></a>
        </li>
        <li>
          <a><i class="fa fa-plus"></i> <i class="fa fa-caret-down"></i></a>
        </li>
        <li class="user-nav-logo">
          <a><img src="/images/avatar.jpg"> <i class="fa fa-caret-down"></i></i></a>
        </li>
      </ul>
    </div>
  </div>
</nav>

<div class="main-container">
  <header class="header-wrapper desktop-only">
  <div class="container header-site-detail">
    <ul class="header-toolbar">
      <li class="clearfix">
        <a href="/archives" class="header-toolbar-left"><i
                  class="fa fa-file-text"></i> Posts </a>
        <a href="/archives"
           class="header-toolbar-right"> 8 </a>
      </li>
      <li>
        <a href="/tags" class="header-toolbar-left"><i
                  class="fa fa-tags"></i> Tags </a>
        <a href="/tags"
           class="header-toolbar-right"> 12 </a>
      </li>
      <li>
        <a href="/categories" class="header-toolbar-left"><i
                  class="fa fa-folder-open"></i> Categories </a>
        <a href="/categories"
           class="header-toolbar-right"> 7 </a>
      </li>
    </ul>
    <h2 class="header-title">
      <i class="fa fa-book text-muted"></i>
      <a href="/">DongKui&#39;s Note</a>
      
      
    </h2>
  </div>

  <div class="container">
    <div class="header-tab-wrapper clearfix">
      <span class="header-tab header-tab-selected"><i class="fa fa-thumbs-o-up"></i> Like</span>
      <span class="header-tab"><i class="fa fa-share-alt"></i> Share</span>
      <span class="header-tab"><i class="fa fa-comments-o"></i> Discussion</span>
      <span class="header-tab"><i class="fa fa-bookmark-o"></i> Bookmark </span>
      <span class="header-tab"><i class="fa fa-smile-o"></i> Smile <i class="fa fa-caret-down"></i></span>
    </div>
  </div>
</header>


<div class="post-container container">
  <h3>
    <i class="fa fa-user-o"></i>
    DongKui

    <span class="post-date float-right" title="{{moment(1469460925000).format('MMM DD, YYYY, h:mm:ss A')}}">
      <i class="fa fa-pencil-square-o"></i>
      {{moment(1469460925000).fromNow()}}
    </span>
  </h3>

  <article class="post-content">
    <h1>Docker compose note (ing)</h1>
    <p>Docker Compose 是定义、构建多容器的 docker 应用的工具。<br>Compose 通过 compose 文件配置应用的服务。之后，用一条指令就可以从配置创建、启动所有服务。 </p>
<a id="more"></a>
<p>和 CI 工作流程搭配，Compose 在开发、测试、模拟环境下非常给力。更多内容参见 <a href="https://docs.docker.com/compose/overview/#common-use-cases" target="_blank" rel="external">Common Use Cases.</a>。</p>
<p>使用 Compose 基于一下三步：</p>
<ul>
<li><ol>
<li>用 Dockerfile 定义应用的环境（以在任何环境下都能重现）</li>
</ol>
</li>
<li><ol>
<li>在 docker-compose.yml 中定义组成应用的服务（services）（以让所有服务能在孤立的环境一起运行）</li>
</ol>
</li>
<li><ol>
<li>最后，运行 <code>docker-compose up</code> ，Compose 会启动，接着运行整个应用。</li>
</ol>
</li>
</ul>
<p><a href="https://docs.docker.com/compose/overview/" target="_blank" rel="external">原文地址</a></p>
<p>docker-compose.yml 格式如下：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="attr">version:</span> <span class="string">'2'</span></div><div class="line"><span class="attr">services:</span></div><div class="line"><span class="attr">  web:</span></div><div class="line"><span class="attr">    build:</span> .</div><div class="line"><span class="attr">    ports:</span></div><div class="line"><span class="bullet">    -</span> <span class="string">"5000:5000"</span></div><div class="line"><span class="attr">    volumes:</span></div><div class="line"><span class="bullet">    -</span> .:/code</div><div class="line"><span class="attr">    - logvolume01:</span>/var/log</div><div class="line"><span class="attr">    links:</span></div><div class="line"><span class="bullet">    -</span> redis</div><div class="line"><span class="attr">  redis:</span></div><div class="line"><span class="attr">    image:</span> redis</div><div class="line"><span class="attr">volumes:</span></div><div class="line"><span class="attr">  logvolume01:</span> &#123;&#125;</div></pre></td></tr></table></figure>
<p>Compose 文件详情参见：<a href="https://docs.docker.com/compose/compose-file/" target="_blank" rel="external">Compose file reference</a></p>
<p>Compose 有管理应用的整个生命周期的指令：</p>
<ul>
<li>Start, stop and rebuild services</li>
<li>View the status of running services</li>
<li>Stream the log output of running services</li>
<li>Run a one-off command on a service</li>
</ul>
<h2 id="特性（Features）"><a href="#特性（Features）" class="headerlink" title="特性（Features）"></a><a href="https://docs.docker.com/compose/overview/#/features" target="_blank" rel="external">特性（Features）</a></h2><ul>
<li>Multiple isolated environments on a single host</li>
<li>Preserve volume data when containers are created</li>
<li>Only recreate containers that have changed</li>
<li>Variables and moving a composition between environments</li>
</ul>
<h2 id="Common-Use-Cases"><a href="#Common-Use-Cases" class="headerlink" title="Common Use Cases"></a>Common Use Cases</h2><p>几种常见用例如下：</p>
<h3 id="开发环境"><a href="#开发环境" class="headerlink" title="开发环境"></a>开发环境</h3><p>开发软件时，在隔离的环境下运行应用和进行交互的能力至关重要。Compose 指令工具可用来创建这种环境并与其交互。</p>
<p>Compose file 提供归档（document）并配置应用的所有服务的依赖（数据库，队列，缓存，web服务API 等等）。使用 Compose 指令工具可以用单独的一行指令（<code>docker-compose up</code>）为每个依赖创建并启动一个或多个容器。</p>
<p>总之，这些特性为开发者提供一条开始开发项目的便捷途径。</p>
<h3 id="自动化测试环境"><a href="#自动化测试环境" class="headerlink" title="自动化测试环境"></a>自动化测试环境</h3><p>任何持续部署或者集成过程的重要一部分是自动测试组件。自动化的端到端测试要求一个运行测试的环境。Compose 为测试组件提供一个方便地创建、销毁隔离地测试环境的途径。通过在 Compose file 中定义整个环境，可用几行指令就创建、销毁这些环境。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ docker-compose up -d</div><div class="line">$ ./run_tests</div><div class="line">$ docker-compose down</div></pre></td></tr></table></figure>
<h3 id="单一主机的部署"><a href="#单一主机的部署" class="headerlink" title="单一主机的部署"></a>单一主机的部署</h3><p>传统地，将 Compose 定位为部署、测试工作流，但每个发布版都展现出更多的生产导向性。可以用 Compose 部署到一个远程 Docker 引擎。该 Docker 引擎可能是一个由 Docker Machine 预分配的单独实例，也可能是整个 Docker Swarm 集群。</p>
<p>更多生产导向性特性，见 <a href="https://docs.docker.com/compose/production/" target="_blank" rel="external">compose in production</a></p>
<h1 id="安装-Compose"><a href="#安装-Compose" class="headerlink" title="安装 Compose)"></a><a href="(https://docs.docker.com/compose/install/">安装 Compose</a>)</h1><ol>
<li>安装 Docker</li>
<li>github 上 Compose repository 发行版页面</li>
<li><p>安装命令：</p>
<figure class="highlight plain"><figcaption><span>-L</span><a href="https://github.com/docker/compose/releases/download/1.7.1/docker-compose-`uname" target="_blank" rel="external">-s`-`uname -m` > /usr/local/bin/docker-compose```</a></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">4. 为二进制文件添加执行权限：</div><div class="line">``` $ chmod +x /usr/local/bin/docker-compose</div></pre></td></tr></table></figure>
</li>
<li><p>检测安装</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ docker-compose --version</div><div class="line">docker-compose version: 1.7.1</div></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="Alternative-install-options"><a href="#Alternative-install-options" class="headerlink" title="Alternative install options"></a>Alternative install options</h2><h3 id="Install-using-pip"><a href="#Install-using-pip" class="headerlink" title="Install using pip"></a>Install using pip</h3><p>Compose can be installed from pypi using pip. If you install using pip it is highly recommended that you use a virtualenv because many operating systems have python system packages that conflict with docker-compose dependencies. See the virtualenv tutorial to get started.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ pip install docker-compose</div></pre></td></tr></table></figure>
<blockquote>
<p>Note: pip version 6.0 or greater is required</p>
</blockquote>
<h3 id="Install-as-a-container"><a href="#Install-as-a-container" class="headerlink" title="Install as a container"></a>Install as a container</h3><p>Compose can also be run inside a container, from a small bash script wrapper. To install compose as a container run:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ curl -L https://github.com/docker/compose/releases/download/1.7.1/run.sh &gt; /usr/local/bin/docker-compose</div><div class="line">$ chmod +x /usr/local/bin/docker-compose</div></pre></td></tr></table></figure>
<h2 id="Master-builds"><a href="#Master-builds" class="headerlink" title="Master builds"></a>Master builds</h2><p>If you’re interested in trying out a pre-release build you can download a binary from <a href="https://dl.bintray.com/docker-compose/master/" target="_blank" rel="external">https://dl.bintray.com/docker-compose/master/</a>. Pre-release builds allow you to try out new features before they are released, but may be less stable.</p>
<h2 id="Upgrading"><a href="#Upgrading" class="headerlink" title="Upgrading"></a>Upgrading</h2><p>If you’re upgrading from Compose 1.2 or earlier, you’ll need to remove or migrate your existing containers after upgrading Compose. This is because, as of version 1.3, Compose uses Docker labels to keep track of containers, and so they need to be recreated with labels added.</p>
<p>If Compose detects containers that were created without labels, it will refuse to run so that you don’t end up with two sets of them. If you want to keep using your existing containers (for example, because they have data volumes you want to preserve) you can use compose 1.5.x to migrate them with the following command:</p>
<pre><code>$ docker-compose migrate-to-labels
</code></pre><p>Alternatively, if you’re not worried about keeping them, you can remove them. Compose will just create new ones.</p>
<pre><code>$ docker rm -f -v myapp_web_1 myapp_db_1 ...
</code></pre><h2 id="Uninstallation"><a href="#Uninstallation" class="headerlink" title="Uninstallation"></a>Uninstallation</h2><p>To uninstall Docker Compose if you installed using curl:</p>
<pre><code>$ rm /usr/local/bin/docker-compose
</code></pre><p>To uninstall Docker Compose if you installed using pip:</p>
<pre><code>$ pip uninstall docker-compose
</code></pre><blockquote>
<p>Note: If you get a “Permission denied” error using either of the above methods, you probably do not have the proper permissions to remove docker-compose. To force the removal, prepend sudo to either of the above commands and run again.</p>
</blockquote>
<h1 id="Getting-Started"><a href="#Getting-Started" class="headerlink" title="Getting Started"></a><a href="https://docs.docker.com/compose/gettingstarted/" target="_blank" rel="external">Getting Started</a></h1><h1 id="Get-started-with-Django"><a href="#Get-started-with-Django" class="headerlink" title="Get started with Django"></a><a href="https://docs.docker.com/compose/django/" target="_blank" rel="external">Get started with Django</a></h1><h1 id="Get-started-with-Rails"><a href="#Get-started-with-Rails" class="headerlink" title="Get started with Rails"></a><a href="https://docs.docker.com/compose/rails/" target="_blank" rel="external">Get started with Rails</a></h1><h1 id="Get-started-with-WordPress"><a href="#Get-started-with-WordPress" class="headerlink" title="Get started with WordPress"></a><a href="https://docs.docker.com/compose/wordpress/" target="_blank" rel="external">Get started with WordPress</a></h1><h1 id="Frequently-asked-questions"><a href="#Frequently-asked-questions" class="headerlink" title="Frequently asked questions"></a><a href="https://docs.docker.com/compose/faq/" target="_blank" rel="external">Frequently asked questions</a></h1><h1 id="Command-line-reference"><a href="#Command-line-reference" class="headerlink" title="Command line reference"></a><a href="https://docs.docker.com/compose/reference/" target="_blank" rel="external">Command line reference</a></h1><h1 id="Compose-file-reference"><a href="#Compose-file-reference" class="headerlink" title="Compose file reference"></a><a href="https://docs.docker.com/compose/compose-file/" target="_blank" rel="external">Compose file reference</a></h1><h1 id="Environment-file"><a href="#Environment-file" class="headerlink" title="Environment file"></a><a href="https://docs.docker.com/compose/env-file/" target="_blank" rel="external">Environment file</a></h1>
  </article>
</div>


    




</div>

<div class="footer-wrapper container">
  <footer class="footer clearfix">
    <a href="http://dongkui.site" class="footer-logo">
      <i class="fa fa-github"></i>
    </a>
    <ul class="footer-social-link">
      <li>© 2016 DongKui</li>
      <li><a href="http://dongkui.site">Home</a></li>
      
    </ul>
    <div class="footer-theme-info">
      Theme <a href="//github.com/sabrinaluo/hexo-theme-replica">Replica</a>
      by <a href="//github.com/sabrinaluo">Hiitea</a> ❤ Powered by Hexo
    </div>
  </footer>
</div>




<script src="/js/main.js"></script>

</body>
</html>
